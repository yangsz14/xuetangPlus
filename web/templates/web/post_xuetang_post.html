{% extends "base.html" %}

{%block css%} <link rel="stylesheet" href="{{BASE_DIR}}/static/postpost.css" /> {% endblock %}

{% block sub-title %}
<h2>添加帖子</h2>
{% endblock %}


{% block title %}学堂Plus{% endblock %}
{% block content %}

    <div class="form">
    <div class="outbox">
        {% if error %}
            <div class="alert alert-danger alert-dismissible" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <strong>Error!</strong> {{ error }}
            </div>
        {% endif %}
        <form class="form-base" action="/postxpostdetail/{{ source }}/" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="messagebox">
                <input type="text" placeholder="Title" name="P_Title" value="{{ P_Title }}">

            <div class="form_row">
                <label for="id_title">题目:</label>
                <input type="text" class="form-control" placeholder="Title" name="P_Title" value="{{ P_Title }}">
            </div>

            <div class="form_row">
                <label for="id_content">内容:</label>
                <input id="id_PContent" type="text" class="form-control" placeholder="Content" name="P_Content" value="{{ P_Content }}"
            </div>

            <div class="area">
                <label for="id_type">分区:{{ source }}</label>
            </div>

            </div>
            <input type="submit" class="button1" value="确认">
        </form>
        <label class="btn btn-default mybutton blue" for="fileImage">上传图片</label>
        <input id="fileImage" type="file" style="position:absolute;clip:rect(0 0 0 0);"/>
        <div class="form_row">
            <label><a href="/">返回</a></label>
        </div>
    </div>
    </div>

    <script type="text/javascript">
    $(function () {
        $('#fileImage').bind("change", function() {
            if ($(this).prop('files')[0].type.indexOf("image") <= -1) {
                alert("请选择图片！");
                return;
            }
            var formdata = new FormData()
            formdata.append("file",$(this).prop('files')[0])
            console.log($(this).prop('files')[0]);
            $.ajax({
                url: "/ajax_append_image/",
                type: "POST",
                data: formdata,
                processData: false,
                contentType: false,
                success: function(data, textStatus) {
                    $("#id_PContent").val($("#id_PContent").val() + "__url_start__" + data + "__url_end__")
                    alert("上传成功")
                }
            });
        })
    });
    </script>
{% endblock %}